#+Title: Installation steps 
#+Author: Systems Team
#+SETUPFILE: ../org-templates/level-1.org
#+TAGS: boilerplate(b)
#+EXCLUDE_TAGS: boilerplate
#+OPTIONS: ^:nil
* Introduction
  This document contains the installation steps to setup the
  whole OpenVZ cluster.
* Requirements
  - A machine/VirualBox with CentOS-6
    - Configuration of system
  - Three free LAN IPs 
    1. One for Host machine( Default IP of the Host machine)
    2. One for Router Container/Server
    3. One for Ansible/config Sever/Container.
* Steps
  1. Boot the machine
  2. Login to the machine
  3. Login to root account
  4. Export network proxy if any
  5. Install git
     #+BEGIN_EXAMPLE
     yum install git -y
     #+END_EXAMPLE
  6. Clone the cluster-automation repository
    #+BEGIN_EXAMPLE
    git clone https://github.com/vlead/cluster-automation.git
    cd cluster-automation
    #+END_EXAMPLE
  7. Run make
  8. Get the google OAuth2 keys from
     [[https://console.developers.google.com/apis/credentials][Google OAuth2 console]]
     
     Note down the =Client ID= and =Client secret=. these
     are needed in the common_vars file( 9th step). 
  9. Edit the file
     =~/cluster-automation/build/code/imp/roles/common_vars/vars/main.yml=
     with the appropriate variable values.
  10. Run =bootstrap.sh=
      #+BEGIN_EXAMPLE
      cd ~/cluster-automation
      sh bootstrap.sh <machine root password>
      #+END_EXAMPLE
* Post Installation steps
** Enable hooks between ADS and Config/ansible server
   - NOTE :: To Enter into containers us the following
             commands on host machine.
	     #+BEGIN_SRC 
	     vzctl enter 1002    #for ansible/config server
	     vzctl enter 1009    #for ADS server
	     vzctl enter CTID    
	     #+END_SRC
   1. Go to ADS server ( container ID - 1009) and copy the
      =~/.ssh/id_rsa.pub= key.
   2. Go to Ansible/config server ( container id - 1002).
      - Use vlead user by executing the below command
	#+BEGIN_SRC 
	su - vlead
	#+END_SRC
   3. Paste the copied ( step 1) key in 
      =/home/vlead/.ssh/authorized_keys= as follows in
      ansible server.
      #+BEGIN_SRC 
      command="hooks.sh",no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty <<ADS-SERVER-id_rsa.pub.key>>
      #+END_SRC
      - NOTE 1 :: Replace <<ADS-SERVER-id_rsa.pub.key>> with
                actual root account's =id_rsa.pub= of ADS
                server.
      - NOTE 2 :: Make sure that the file
                  =/home/vlead/.ssh/authorized_keys=
                  permissions should be 644.
   
  

   
